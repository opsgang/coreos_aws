# vim: et sr sw=4 ts=4 smartindent syntax=sh:
# ... to be sourced by /home/core/bin/functions
#
function credstash_get_help() {
    cat <<EOM
usage: credstash_get <MY_SECRET_NAME>
... gets a secret value from cached credstash json
e.g.
    credstash_get DATADOG_API_KEY
EOM

}

# credstash_get():
# ... only useful if /home/core/bin/credstash_to_fs has been invoked.
#     which should happen after instance_info is generated.
function credstash_get() {
    json=/etc/custom/.credstash.json
    local secret_name="$1"
    if [[ ! -r $json ]]; then
        echo "$0 ERROR: no readable credstash.json at $json" >&2
        echo ""
        return 1
    fi

    local val=$(jq -r ".\"$secret_name\"" $json)
    if [[ "$val" == "null" ]]; then
        val=""
    fi
    echo "$val"
}
